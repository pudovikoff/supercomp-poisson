# Решение задачи Пуассона методом фиктивных областей

## Вариант 7: Область-сапожок

### Описание задачи

Решается двумерная задача Дирихле для уравнения Пуассона:
```
-Δu = f(x, y),  (x, y) ∈ D
u(x, y) = 0,    (x, y) ∈ γ
```

где:
- **Область D (сапожок)**: `{(x,y): -1 < x,y < 1} \ {(x,y): 0 < x,y < 1}`
  - Это квадрат `[-1, 1] × [-1, 1]` с вырезанным правым верхним квадрантом `[0, 1] × [0, 1]`
- **Правая часть**: `f(x, y) = 1` для всех `(x, y) ∈ D`

### Метод решения

1. **Метод фиктивных областей**: криволинейная область заменяется прямоугольником с кусочно-постоянным коэффициентом
   - k(x, y) = 1 в области D
   - k(x, y) = 1/ε в фиктивной области (вне D)
   - ε = h² (квадрат максимального шага сетки)

2. **Разностная схема**: пятиточечная схема на равномерной прямоугольной сетке

3. **Решение СЛАУ**: метод сопряженных градиентов с диагональным предобуславливанием

### Структура кода

#### Основные функции

1. **Геометрические функции**:
   - `is_in_domain(x, y)` - проверка принадлежности точки области D
   - `segment_length_in_D(...)` - длина отрезка в области D
   - `cell_area_in_D(...)` - площадь пересечения ячейки с областью D

2. **Класс PoissonSolver**:
   - `compute_coefficients()` - вычисление коэффициентов a, b, F
   - `apply_A(...)` - применение оператора разностной схемы
   - `apply_D_inv(...)` - применение предобуславливателя
   - `solve_CG(...)` - метод сопряженных градиентов
   - `save_solution(...)` - сохранение решения в файл

#### Архитектурные решения

- **Модульность**: геометрия отделена от численных методов
- **Расширяемость**: легко изменить область (изменить функцию `is_in_domain`)
- **Читаемость**: функции с понятными именами, комментарии на русском языке
- **Эффективность**: оптимизация O3, минимальные вычислительные затраты

### Компиляция и запуск

```bash
# Компиляция
make

# Запуск
./poisson_sequential

# Или сразу компиляция и запуск
make run

# Очистка
make clean
```

### Результаты работы

Программа выполняет расчеты на трех сетках:
- 10 × 10
- 20 × 20  
- 40 × 40

Для каждой сетки выводится:
- Количество итераций
- Время решения (в секундах)
- Евклидова норма решения ||w||_E
- Максимум норма решения ||w||_C

Решение на сетке 40×40 сохраняется в файл `solution_40x40.txt` в формате:
```
x y w(x,y)
```

### Особенности реализации

1. **Граничные условия**: автоматически учитываются через нулевые значения на границе прямоугольника

2. **Вычисление коэффициентов**: 
   - Для вертикальных/горизонтальных отрезков используется аналитический подход
   - Для ячеек учитывается геометрия сапожка

3. **Контроль сходимости**:
   - Условие остановки: ||w^(k+1) - w^(k)||_E < δ
   - Контроль монотонности функционала H(w)
   - Автоматический перезапуск при нарушении монотонности

4. **Предобуславливание**:
   - Диагональный предобуславливатель значительно ускоряет сходимость
   - D_ii = (a_{i+1,j} + a_{i,j})/h1² + (b_{i,j+1} + b_{i,j})/h2²

### Дальнейшее развитие

Эта последовательная версия является базой для:
- **OpenMP-версии**: параллелизация циклов по сетке
- **MPI-версии**: разбиение области на домены
- **Гибридной MPI+OpenMP версии**: двухуровневый параллелизм

### Требования

- Компилятор: g++ с поддержкой C++11
- ОС: Linux, macOS (протестировано на macOS)
