# Отчет по решению задачи Пуассона методом фиктивных областей

## Вариант 7: Область-сапожок

**Автор:** Пудовников А.Д.  
**Дата:** 29 октября 2025  
**Курс:** Суперкомпьютерное моделирование и технологии

---

## 1. Постановка задачи

### 1.1 Математическая формулировка

Требуется решить двумерную задачу Дирихле для уравнения Пуассона:

```
-Δu = f(x, y),  (x, y) ∈ D
u(x, y) = 0,    (x, y) ∈ γ
```

где:
- **Оператор Лапласа:**  
  $$\Delta u = \frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2}$$

- **Правая часть:**  
  $$f(x, y) = 1 \quad \forall (x, y) \in D$$

- **Область D (сапожок):**  
  $$D = \{(x,y): -1 < x, y < 1\} \setminus \{(x,y): 0 \leq x, y < 1\}$$

  Это квадрат $[-1, 1] \times [-1, 1]$ с вырезанным правым верхним квадрантом $[0, 1] \times [0, 1]$.

- **Граница γ:**  
  $$\gamma = \partial D$$

### 1.2 Геометрия области

![Область-сапожок](results/plot_d.png)

**Свойства области:**
- Площадь: $S_D = 3$ (квадрат 2×2 минус квадрат 1×1)
- Область несвязная (L-образная)
- Граница кусочно-гладкая с угловой точкой в (0, 0)

---

## 2. Метод решения

### 2.1 Метод фиктивных областей

Криволинейная область $D$ заменяется прямоугольником:

$$\Pi = \{(x, y) : -1 < x < 1, -1 < y < 1\}$$

с введением кусочно-постоянного коэффициента:

$$k(x, y) = \begin{cases}
1, & (x, y) \in D \\
1/\varepsilon, & (x, y) \in \hat{D}
\end{cases}$$

где $\hat{D} = \Pi \setminus D$ — фиктивная область, $\varepsilon = h^2$ — параметр метода ($h$ — максимальный шаг сетки).

Решается вспомогательная задача:

$$-\frac{\partial}{\partial x}\left(k(x,y)\frac{\partial v}{\partial x}\right) - \frac{\partial}{\partial y}\left(k(x,y)\frac{\partial v}{\partial y}\right) = F(x, y)$$

$$v(x, y) = 0, \quad (x, y) \in \Gamma$$

где:

$$F(x, y) = \begin{cases}
f(x, y) = 1, & (x, y) \in D \\
0, & (x, y) \in \hat{D}
\end{cases}$$

**Теорема (приближение):**  
$$\max_{(x,y) \in D} |v(x, y) - u(x, y)| < C\varepsilon$$

### 2.2 Разностная схема

На равномерной прямоугольной сетке $\bar{\omega}_h = \bar{\omega}_1 \times \bar{\omega}_2$:

$$\bar{\omega}_1 = \{x_i = -1 + ih_1, \, i = 0, \overline{M}\}, \quad h_1 = \frac{2}{M}$$
$$\bar{\omega}_2 = \{y_j = -1 + jh_2, \, j = 0, \overline{N}\}, \quad h_2 = \frac{2}{N}$$

Дифференциальное уравнение аппроксимируется разностным:

$$-\frac{1}{h_1}\left(a_{i+1,j}\frac{w_{i+1,j} - w_{i,j}}{h_1} - a_{i,j}\frac{w_{i,j} - w_{i-1,j}}{h_1}\right) - \frac{1}{h_2}\left(b_{i,j+1}\frac{w_{i,j+1} - w_{i,j}}{h_2} - b_{i,j}\frac{w_{i,j} - w_{i,j-1}}{h_2}\right) = F_{i,j}$$

для $i = 1, \overline{M-1}$, $j = 1, \overline{N-1}$.

**Коэффициенты:**

$$a_{i,j} = \frac{1}{h_2}\int_{y_{j-1/2}}^{y_{j+1/2}} k(x_{i-1/2}, t) \, dt$$

$$b_{i,j} = \frac{1}{h_1}\int_{x_{i-1/2}}^{x_{i+1/2}} k(t, y_{j-1/2}) \, dt$$

**Правая часть:**

$$F_{i,j} = \frac{1}{h_1 h_2}\iint_{\Pi_{i,j}} F(x, y) \, dx \, dy$$

где $\Pi_{i,j}$ — ячейка сетки вокруг узла $(x_i, y_j)$.

**Граничные условия:**

$$w_{i,j} = 0, \quad (x_i, y_j) \in \Gamma$$

### 2.3 Метод сопряженных градиентов с предобуславливанием

Разностная схема приводится к системе линейных алгебраических уравнений:

$$Aw = B$$

где $A : H \to H$ — самосопряженный положительно определенный оператор.

**Скалярное произведение и норма:**

$$(u, v) = \sum_{i=1}^{M-1}\sum_{j=1}^{N-1} h_1 h_2 \, u_{i,j} v_{i,j}$$

$$\|u\|_E = \sqrt{(u, u)}$$

**Диагональный предобуславливатель:**

$$(Dw)_{i,j} = \left[\frac{a_{i+1,j} + a_{i,j}}{h_1^2} + \frac{b_{i,j+1} + b_{i,j}}{h_2^2}\right] w_{i,j}$$

**Алгоритм:**

1. Начальное приближение: $w^{(0)} = 0$
2. Невязка: $r^{(0)} = B - Aw^{(0)} = B$
3. Решение: $Dz^{(0)} = r^{(0)}$
4. Направление спуска: $p^{(1)} = z^{(0)}$

Для $k = 0, 1, 2, \ldots$ до сходимости:

5. $Ap^{(k+1)}$ — применение оператора
6. $\alpha_{k+1} = \frac{(z^{(k)}, r^{(k)})}{(Ap^{(k+1)}, p^{(k+1)})}$
7. $w^{(k+1)} = w^{(k)} + \alpha_{k+1} p^{(k+1)}$
8. **Проверка сходимости:** если $\|w^{(k+1)} - w^{(k)}\|_E < \delta$, то STOP
9. $r^{(k+1)} = r^{(k)} - \alpha_{k+1} Ap^{(k+1)}$
10. $Dz^{(k+1)} = r^{(k+1)}$
11. $\beta_{k+1} = \frac{(z^{(k+1)}, r^{(k+1)})}{(z^{(k)}, r^{(k)})}$
12. $p^{(k+1)} = z^{(k+1)} + \beta_{k+1} p^{(k)}$

**Контроль монотонности:**

Функционал $H(w^{(k)}) = (B + r^{(k)}, w^{(k)})$ должен монотонно возрастать. При нарушении монотонности — перезапуск метода.

---

## 3. Реализация

### 3.1 Структура программы

```cpp
// 1. Геометрические функции
bool is_in_domain(double x, double y)
double segment_length_in_D(...)
double cell_area_in_D(...)

// 2. Класс PoissonSolver
class PoissonSolver {
    void compute_coefficients()   // Вычисление a, b, F
    void apply_A(...)              // Оператор A
    void apply_D_inv(...)          // Предобуславливатель D^{-1}
    void solve_CG(...)             // Метод сопряженных градиентов
    double dot_product(...)        // Скалярное произведение
    double euclidean_norm(...)     // Евклидова норма
    double max_norm(...)           // Максимум норма
    void save_solution(...)        // Сохранение результата
}

// 3. Основная программа
int main() {
    // Цикл по сеткам 10×10, 20×20, 40×40
    // Решение задачи
    // Вывод результатов
}
```

### 3.2 Особенности реализации

1. **Модульность:** геометрия отделена от численного метода
2. **Вычисление коэффициентов:** аналитическое интегрирование по отрезкам/ячейкам
3. **Предобуславливание:** диагональная матрица $D$ для ускорения сходимости
4. **Контроль качества:** проверка монотонности функционала, автоматический перезапуск
5. **Оптимизация:** флаг `-O3`, минимизация копирований данных

---

## 4. Результаты

### 4.1 Численные результаты

| Сетка $M \times N$ | Узлов | Итераций | Время (с) | $\\|w\\|_E$ | $\\|w\\|_C$ |
|--------------------|-------|----------|-----------|-------------|-------------|
|| 10 × 10            | 81    | 21       | 0.000020  | 1.497e-01   | 1.512e-01   |
|| 20 × 20            | 361   | 40       | 0.000149  | 1.450e-01   | 1.492e-01   |
|| 40 × 40            | 1521  | 73       | 0.001105  | 1.441e-01   | 1.491e-01   |

#### Визуализация решения

**2D визуализация (цветная карта и изолинии):**

![2D визуализация решения](results/solution_2d.png)

**3D визуализация (поверхность с контурами):**

![3D визуализация решения](results/solution_3d.png)

Из визуализации видно:
- Решение положительно во всей области ($f = 1 > 0$)
- Максимум значения $u \approx 0.149$ достигается внутри области
- Значения плавно убывают к границе (граничное условие $u = 0$)
- Решение симметрично относительно диагонали $y = x$

### 4.2 Анализ сходимости

**Сходимость норм при измельчении сетки:**

- $|\\|w\\|_E^{(20)} - \\|w\\|_E^{(10)}| = 0.00476$
- $|\\|w\\|_E^{(40)} - \\|w\\|_E^{(20)}| = 0.00093$

Разница уменьшается более чем в 5 раз, что подтверждает **монотонную сходимость** к стационарному значению.

**Скорость сходимости итерационного метода:**

- Количество итераций растет примерно линейно с размером сетки
- Время решения растет квадратично (как ожидается для 2D задачи)

### 4.3 Проверка корректности

✅ **Тест геометрии:** 100% (все точки области корректно идентифицированы)  
✅ **Тест площади:** 75% точек в области (ожидалось 75%)  
✅ **Тест граничных условий:** $u|_\Gamma = 0$ выполнено  
✅ **Тест физической корректности:** решение положительно ($f > 0$)  
✅ **Тест сходимости:** норма стабилизируется при измельчении сетки

### 4.4 Свойства решения

1. **Положительность:** $u(x, y) > 0$ для всех $(x, y) \in D$ (так как $f = 1 > 0$)
2. **Максимум:** достигается внутри области (принцип максимума для эллиптических уравнений)
3. **Симметрия:** решение примерно симметрично относительно диагонали $y = x$ (из-за геометрии области)
4. **Граничные значения:** $u \to 0$ при приближении к границе

---

## 5. Выводы

1. **Реализована и протестирована** последовательная программа для решения задачи Пуассона в области-сапожок

2. **Метод фиктивных областей** позволяет свести задачу в сложной области к задаче в прямоугольнике

3. **Метод сопряженных градиентов** с диагональным предобуславливанием обеспечивает:
   - Быструю сходимость (21-73 итерации)
   - Вычислительную эффективность (0.001 с на сетке 40×40)
   - Надежность (контроль монотонности)

4. **Точность решения:** норма стабилизируется на уровне $\\|u\\|_E \approx 0.144$

5. **Программа готова** для следующих этапов:
   - Параллелизация с OpenMP (директивы в циклах)
   - Распределение с MPI (декомпозиция области)
   - Гибридная версия MPI+OpenMP
   - Запуск на суперкомпьютере IBM Polus

---

## 6. Структура проекта

```
SuperComp/
├── src/
│   ├── poisson_sequential.cpp      # Основная программа
│   └── plot_solution.py            # Визуализация (Python)
├── tests/
│   └── test_poisson.cpp            # Тесты корректности
├── docs/
│   ├── POISSON_TASK.md             # Описание задачи
│   ├── USAGE.md                    # Инструкция по использованию
│   ├── QUICKSTART.md               # Быстрый старт
│   └── IMPLEMENTATION_SUMMARY.md   # Технические детали
├── results/
│   └── solution_40x40.txt          # Результаты расчета
├── Makefile                        # Сборка проекта
├── REPORT.md                       # Данный отчет
└── README.md                       # Общая информация
```

---

## 7. Команды для запуска

```bash
# Компиляция
make

# Запуск основной программы
./poisson_sequential

# Компиляция и запуск тестов
g++ -std=c++11 -O3 -Wall -o test_poisson tests/test_poisson.cpp
./test_poisson

# Визуализация (требует Python + matplotlib)
python3 src/plot_solution.py

# Очистка
make clean
```

---

## Литература

1. А.Н. Тихонов, А.А. Самарский. Уравнения математической физики. М. Изд. "Наука". 1977.
2. Г.И. Марчук. Методы вычислительной математики. М. Изд. "Наука". 1989.
3. А.А. Самарский. Теория разностных схем. М. Изд. "Наука". 1989.
4. А.А. Самарский, А.В. Гулин. Численные методы. М. Изд. "Наука". 1989.
5. В.Б. Андреев. Численные методы. М. Изд. "Макс Пресс". 2013.

---

## 8. Таблицы для отчета (заполнить после запусков на Polus)

Таблица 1: OpenMP версии (по «Задание 1-2 потоки 2025.pdf»)

| Кол-во нитей | Сетка (M×N) | Итераций | Время, с | Ускорение |
|---:|---:|---:|---:|---:|
| 1 | 400 600 | 533 | 10.59| - |
| 2 | 400×600 | 533 | 5.03 | |
| 4 | 400×600 | 533 | 2.54 | |
| 8 | 400×600 | 533 | 2.11 | |
| 16 | 400×600 | 533 | 2.17 | |
| 4 | 800×1200 | 1048 | 20.03 | |
| 8 | 800×1200 | 1048 | 16.56 | |
| 16 | 800×1200 | 1048 | 15.73 | |
| 32 | 800×1200 | 1048 | 15.63 | |
